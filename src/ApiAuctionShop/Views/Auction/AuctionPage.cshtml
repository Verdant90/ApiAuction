@model BiddingViewModel
@using Projekt.Controllers;


<h2>@Model.d["Auction"][ViewContext.RouteData.Values["language"].ToString().Substring(0, 2)]</h2>

<div>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.title)
        </dt>
        <dd>
            <h4>
                @Html.DisplayFor(model => model.auctionToSend.title)
            </h4>
        </dd>
        <dd>
            @if (Model.auctionToSend.imageFiles != null && Model.auctionToSend.imageFiles.Count > 0)
            {
                // sparsowanie �cie�ki
                String path = Model.auctionToSend.imageFiles.ElementAt(0).ImagePath;
                int index = path.IndexOf(@"\images");
                path = path.Substring(index);
                <img id="mainimage" src="@String.Format(path)" width="400" height="400" alt="" data-toggle="modal" data-target=".bs-example-modal-lg" onclick="setCarouselActiveItem()" />
            }
            else
            {
                @: Brak zdjecia.

            }
        </dd>
        <dd>
            @if (Model.auctionToSend.imageFiles != null && Model.auctionToSend.imageFiles.Count > 1)
            {
                @foreach (var image in Model.auctionToSend.imageFiles)
                {

                    // sparsowanie �cie�ki
                    String path = image.ImagePath;
                    int index = path.IndexOf(@"\images");
                    path = path.Substring(index);
                    <img onclick="changeImage(this)" src="@String.Format(path)" width="100" height="100" alt="" />

                }
            }
        </dd>
        
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.description)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.auctionToSend.description)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.startDate)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.auctionToSend.startDate)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.endDate)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.auctionToSend.endDate)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.startPrice)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.auctionToSend.startPrice)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.buyPrice)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.auctionToSend.buyPrice)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.state)
        </dt>
        <dd>
            @Html.DisplayFor(model => model.auctionToSend.state)
        </dd>
        <dt>
            @Html.DisplayNameFor(model => model.auctionToSend.editable)
        </dt>
        <dd>
            @if (Model.auctionToSend.editable)
            {
               @: Yes

            }
            else
            {
               @: No
            }
        </dd>

       
    </dl>
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div id="myCarousel" class="carousel slide" data-ride="carousel" data-interval="false">

                    <div class="carousel-inner">
                        @if (Model.auctionToSend.imageFiles != null && Model.auctionToSend.imageFiles.Count > 0)
                        {
                            var i = 0;
                            @foreach (var image in Model.auctionToSend.imageFiles)
                            {

                                // sparsowanie �cie�ki
                                String path = image.ImagePath;
                                int index = path.IndexOf(@"\images");
                                path = path.Substring(index);

                                var itemClass = i++ == 0 ? "item active" : "item";
                                <div class="@itemClass">
                                    <img class="img-responsive" src=@path alt="" style="width:1440px;height:720px" />
                                </div>
                            }
                        }
                        
                    </div>
                    <!-- Controls -->
                    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    @if (Model.auctionToSend.state == "active")
    {
        <h2>Licytacja</h2>

        @using (Html.BeginForm("CreateBid", "Auction", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(model => model.auctionToSend.ID)
            @Html.EditorFor(model => model.bid, new { @Value = "" })
            <input type="submit" value="Licytuj!" />

        }
        <br />
        @if (Model.hasBuyNowGlobal && Model.auctionToSend.buyPrice != null)
        {
            @using (Html.BeginForm("BuyNow", "Auction", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(model => model.auctionToSend.ID)
                <input type="submit" value="Kup teraz za @Model.auctionToSend.buyPrice.ToString() zl!" />

            }
        }
    }
    <br />
    @if (Model.auctionToSend.state == "active" && Model.auctionToSend.editable == true)
    {
        @: Autor zastrzegl prawo do zakonczenia aukcji przed czasem.

    }
    <br />
    @if (Model.bids.Count > 0)
    {
        <h2>@Model.d["BuyOffers"][ViewContext.RouteData.Values["language"].ToString().Substring(0, 2)]</h2>
        <br />
        <table style="width:100%">
            <tr>
                <th>@Model.d["No"][ViewContext.RouteData.Values["language"].ToString().Substring(0, 2)]</th>
                <th>@Model.d["User"][ViewContext.RouteData.Values["language"].ToString().Substring(0, 2)]</th>
                <th>@Model.d["Price"][ViewContext.RouteData.Values["language"].ToString().Substring(0, 2)]</th>
                <th>@Model.d["BidDate"][ViewContext.RouteData.Values["language"].ToString().Substring(0, 2)]</th>
            </tr>
            @foreach (var b in Model.bids.Select((value, i) => new { i = ++i, value }))
            {
                <tr>
                    <td>@b.i.</td>
                    <td>@b.value.bidAuthor</td>
                    <td>@b.value.bid.ToString("C")</td>
                    <td>@b.value.bidDate.ToString()</td>
                </tr>

            }
        </table>
    }
    else
    {
        @if (Model.auctionToSend.state == "active")
        {
            <h4>No bids yet!</h4>
        }
        else if (Model.auctionToSend.state == "waiting")
        {

            <h4>The auction hasn't started yet. </h4>
        }

    }
</div>

<script>

    // ustawienie slajdu Carousel na obrazek, kt�ry obecnie jest obrazkiemm g��wnym
    function setCarouselActiveItem()
    {
        var currentActive = jQuery('.carousel-inner').find('.active');
        currentActive.removeClass('active');

        var path = mainimage.src
        var index = path.indexOf("\images");
        path = path.substring(index - 1);
        path = path.replace(/\//g, '\\');

        // szukanie w Carousel slajdu, kt�ry ma taki sam url co obrazek g��wny
        $('.carousel-inner .item').each(function (index)
        {
            if ($(this).find('img').attr('src') == path)
                $(this).addClass('active');
        });

    }

    function changeImage(img)
    {
        var mainimage = document.getElementById("mainimage")
        mainimage.src = img.src;
    }
</script>